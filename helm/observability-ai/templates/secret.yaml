{{- if not .Values.secrets.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "observability-ai.fullname" . }}
  labels:
    {{- include "observability-ai.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Claude API Key
  claude-api-key: {{ .Values.secrets.claudeApiKey | required "secrets.claudeApiKey is required" | quote }}

  # JWT Secret (must be at least 32 characters in production)
  jwt-secret: {{ .Values.secrets.jwtSecret | required "secrets.jwtSecret is required" | quote }}

  # Database Password
  {{- if .Values.postgresql.enabled }}
  db-password: {{ .Values.postgresql.auth.password | required "postgresql.auth.password is required when postgresql.enabled=true" | quote }}
  {{- else }}
  db-password: {{ .Values.externalDatabase.password | required "externalDatabase.password is required when postgresql.enabled=false" | quote }}
  {{- end }}

  # Redis Password
  {{- if .Values.redis.enabled }}
  redis-password: {{ .Values.redis.auth.password | required "redis.auth.password is required when redis.enabled=true" | quote }}
  {{- else }}
  redis-password: {{ .Values.externalRedis.password | default "" | quote }}
  {{- end }}

  {{- if .Values.config.mimir.authType }}
  {{- if eq .Values.config.mimir.authType "basic" }}
  # Mimir Basic Auth
  mimir-username: {{ .Values.secrets.mimirUsername | quote }}
  mimir-password: {{ .Values.secrets.mimirPassword | quote }}
  {{- else if eq .Values.config.mimir.authType "bearer" }}
  # Mimir Bearer Token
  mimir-bearer-token: {{ .Values.secrets.mimirBearerToken | quote }}
  {{- end }}
  {{- end }}
{{- end }}
